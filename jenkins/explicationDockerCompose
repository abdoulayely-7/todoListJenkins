version: '3.8'

services:
  jenkins:
    image: jenkins/jenkins:lts-jdk21
    container_name: jenkins-master
    user: root
    ports:
      - "8181:8080"
      - "50000:50000"
    volumes:
      - jenkins_home:/var/jenkins_home
      # âš™ï¸ AccÃ¨s Docker depuis Jenkins
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker
    networks:
      - jenkins
    restart: unless-stopped

  agent:
    image: jenkins/inbound-agent:latest
    container_name: jenkins-agent-node
    depends_on:
      - jenkins
    environment:
      - JENKINS_URL=http://jenkins:8080        # âš ï¸ Le master est joignable par son nom de service (pas besoin d'IP)
      - JENKINS_AGENT_NAME=jenkins-agent-node
      - JENKINS_SECRET=<le-token-de-ton-node>  # âš ï¸ Ã€ remplacer par ton secret rÃ©el
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker
    networks:
      - jenkins
    restart: unless-stopped

networks:
  jenkins:

volumes:
  jenkins_home:

Explication ligne par ligne
ğŸ”¹ RÃ©seau partagÃ©
networks:
  jenkins:


â†’ Les deux services partagent ce rÃ©seau privÃ© jenkins, donc tu peux utiliser http://jenkins:8080 comme URL pour lâ€™agent.

ğŸ”¹ Connexion agent â†’ master
environment:
  - JENKINS_URL=http://jenkins:8080
  - JENKINS_AGENT_NAME=jenkins-agent-node
  - JENKINS_SECRET=<le-token-de-ton-node>


Le secret vient de ton interface Jenkins :
Manage Jenkins â†’ Nodes â†’ jenkins-agent-node â†’ Configure â†’ Secret

ğŸ”¹ Docker dans Docker

On monte :

- /var/run/docker.sock:/var/run/docker.sock
- /usr/bin/docker:/usr/bin/docker


â†’ Ã‡a permet Ã  lâ€™agent dâ€™exÃ©cuter des docker build, docker push, etc.
(ce nâ€™est pas du Docker-in-Docker, câ€™est Docker-from-Host, plus lÃ©ger et plus sÃ»r âœ…)

ğŸ”¹ RedÃ©marrage automatique
restart: unless-stopped


â†’ Ton agent revient automatiquement aprÃ¨s reboot.

ğŸš€ Ã‰tapes Ã  suivre

RÃ©cupÃ¨re le token du node
Dans Jenkins UI :

Manage Jenkins â†’ Nodes â†’ jenkins-agent-node â†’ Configure â†’ Secret


Colle-le dans ton docker-compose.yml
Ligne :

- JENKINS_SECRET=<le-token-de-ton-node>


Relance tes services

docker compose up -d


VÃ©rifie les logs

docker logs -f jenkins-agent-node


Tu devrais voir :

INFO: Connected to Jenkins controller


â†’ âœ… Si oui, ton agent est prÃªt.

ğŸ§© VÃ©rification finale

Va dans Jenkins :

Manage Jenkins â†’ Nodes


Tu verras :

jenkins-agent-node (connected)


ğŸŸ¢ En vert = parfait, ton build distribuÃ© est prÃªt.